<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Narwhal Homework & Progress Tracker</title>
    <!-- Confetti Library -->
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.5.1/dist/confetti.browser.min.js"></script>
    <!-- Google Fonts for Professional Typography -->
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&display=swap" rel="stylesheet">
    <!-- Font Awesome for Icons -->
    <script src="https://kit.fontawesome.com/a076d05399.js" crossorigin="anonymous"></script>
    <style>
        /* General Styles */
        body {
            font-family: 'Montserrat', sans-serif;
            background: #ffffff; /* Clean white background */
            margin: 0;
            padding: 0;
            text-align: center;
            box-sizing: border-box;
            color: #2c3e50; /* Softer dark color for text */
            overflow-x: hidden;
        }

        /* Startup Modal Styles */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(1, 87, 155, 0.85); /* Semi-transparent dark blue */
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            animation: fadeIn 0.6s ease-in-out;
        }

        .modal {
            background-color: #ffffff;
            padding: 40px;
            border-radius: 15px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.3);
            width: 90%;
            max-width: 500px;
            text-align: center;
            position: relative;
            display: flex;
            flex-direction: column;
            align-items: center; /* Center buttons */
        }

        .modal h2 {
            font-size: 2rem;
            margin-bottom: 20px;
            color: #0288d1; /* Blue */
        }

        .modal p {
            font-size: 1.1rem;
            margin-bottom: 30px;
            color: #0277bd; /* Slightly darker blue */
        }

        .modal-buttons {
            display: flex;
            flex-direction: column; /* Stack buttons vertically */
            align-items: center;
            gap: 15px; /* Space between buttons */
            width: 100%;
        }

        /* For larger screens, arrange buttons horizontally */
        @media (min-width: 600px) {
            .modal-buttons {
                flex-direction: row;
                justify-content: center;
            }
        }

        .modal-buttons button {
            width: 200px; /* Fixed width for uniformity */
            background: linear-gradient(45deg, #0288d1, #01579b); /* Blue gradient */
            border: none;
            color: white;
            padding: 15px 25px;
            font-size: 1rem;
            border-radius: 30px;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
            display: flex;
            align-items: center;
            gap: 10px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.2);
            text-align: center;
            height: 50px; /* Fixed height for uniformity */
            justify-content: center;
        }

        .modal-buttons button:hover {
            transform: scale(1.05);
            box-shadow: 0 6px 15px rgba(0,0,0,0.3);
        }

        /* Animations */
        @keyframes fadeIn {
            from { opacity: 0; transform: scale(0.8); }
            to { opacity: 1; transform: scale(1); }
        }

        @keyframes slideIn {
            from { opacity: 0; transform: translateY(-20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Navigation Bar Styles */
        .navbar {
            background: #ffffff;
            padding: 20px 0;
            position: sticky;
            top: 0;
            z-index: 900;
            display: flex;
            justify-content: center; /* Center by default */
            align-items: center;
            gap: 30px;
            transition: all 0.3s ease;
            border-bottom: 1px solid rgba(0, 150, 199, 0.1);
        }

        .navbar.scrolled {
            justify-content: space-between;
            padding: 20px 40px;
        }

        /* Navbar Info Styles */
        .navbar-info {
            display: none; /* Hidden by default */
            align-items: center;
            gap: 30px;
            font-size: 0.9rem;
            color: #3498db;
            transition: all 0.3s ease;
        }

        .navbar-countdown {
            font-weight: 500;
        }

        .navbar-quote {
            font-style: italic;
            max-width: 300px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        /* Navigation Buttons Container */
        .navbar-buttons {
            display: flex;
            gap: 30px;
            align-items: center;
            transition: all 0.3s ease;
        }

        /* Responsive adjustments */
        @media (max-width: 1024px) {
            .navbar-quote {
                display: none;
            }
        }

        @media (max-width: 768px) {
            .navbar {
                flex-direction: column;
                padding: 10px 20px;
                gap: 10px;
            }
            
            .navbar-info {
                order: -1;
            }
        }

        /* Navbar Button Styles */
        .navbar button.nav-button {
            background: none;
            border: none;
            color: #95a5a6; /* Muted color for inactive state */
            font-size: 0.95rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            padding: 10px 20px;
            position: relative;
        }

        .navbar button.nav-button::after {
            content: '';
            position: absolute;
            bottom: -2px;
            left: 50%;
            transform: translateX(-50%);
            width: 0;
            height: 2px;
            background: #3498db; /* Underwater blue */
            transition: width 0.3s ease;
        }

        .navbar button.nav-button:hover::after {
            width: 100%;
        }

        .navbar button.nav-button.active {
            color: #3498db; /* Underwater blue */
            font-weight: 600;
        }

        .navbar button.nav-button.active::after {
            width: 100%;
        }

        /* Reset Button Styles */
        .navbar .reset-button {
            background: none;
            color: #e74c3c; /* Subtle red */
            border: 1px solid #e74c3c;
            padding: 8px 16px;
            font-size: 0.9rem;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .navbar .reset-button:hover {
            background: #e74c3c;
            color: white;
        }

        /* Countdown and Quote Styles */
        .countdown-container, .quote-container {
            margin: 25px auto;
            padding: 15px;
            max-width: 800px;
            text-align: center;
        }

        .countdown-container span, .quote-container span {
            font-size: 1.3rem;
            font-weight: bold;
            display: block;
            margin-bottom: 10px;
            color: #0288d1; /* Blue */
        }

        /* Quote Section Redesign */
        .quote-container {
            font-style: italic;
            font-size: 1.1rem;
            color: #0277bd; /* Slightly darker blue */
            padding: 20px;
            /* Removed background and box-shadow for minimalistic look */
            position: relative;
            overflow: hidden;
            /* Added label */
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .quote-container::before {
            content: "üìú Quote of the Day";
            font-size: 1.2rem;
            font-weight: bold;
            margin-bottom: 10px;
            color: #01579b; /* Dark blue */
        }

        /* Progress and Homework Section Styles */
        .progress-section, .homework-section {
            margin: 25px auto;
            padding: 25px;
            max-width: 1200px;
            text-align: center;
            background-color: #ffffff;
            border-radius: 15px;
            box-shadow: 0 4px 20px rgba(41, 128, 185, 0.05); /* Very subtle blue shadow */
            animation: fadeIn 1s ease-in-out;
            position: relative; /* For 'Uncheck All' button positioning */
        }

        .progress-section h2, .homework-section h2 {
            font-size: 1.8rem;
            margin-bottom: 25px;
            color: #01579b; /* Dark blue */
            position: relative;
            display: inline-block;
        }

        .progress-section h2::after, .homework-section h2::after {
            content: '';
            position: absolute;
            width: 50px;
            height: 3px;
            background-color: #0288d1;
            left: 50%;
            bottom: -10px;
            transform: translateX(-50%);
            border-radius: 2px;
        }

        /* Class Progress Bar */
        .class-progress-bar {
            position: relative;
            width: 80%;
            height: 25px;
            background-color: #f5f6fa;
            border-radius: 12.5px;
            margin: 0 auto 30px auto;
            overflow: hidden;
        }

        .class-progress-fill {
            position: absolute;
            left: 0;
            top: 0;
            height: 100%;
            background: linear-gradient(90deg, #0288d1, #01579b);
            border-radius: 12.5px;
            transition: width 0.5s ease-in-out;
        }

        .progress-percentage {
            position: absolute;
            width: 100%;
            top: 0;
            left: 0;
            text-align: center;
            color: #333333;
            font-weight: bold;
            line-height: 25px;
            text-shadow: 
                -1px -1px 0 #fff,
                1px -1px 0 #fff,
                -1px 1px 0 #fff,
                1px 1px 0 #fff;
        }

        /* Grid Container */
        .grid-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 25px;
            padding: 20px;
            max-width: 1200px;
            margin: 0 auto;
        }

        /* Progress Circle Container */
        .progress-circle-container {
            display: grid;
            grid-template-areas: 
                "reading language ."
                ". quizzes .";
            grid-template-columns: repeat(3, 1fr);
            grid-gap: 6px;
            justify-content: center;
            margin: 10px auto;
            padding: 0;
            width: 100%;
            max-width: 160px;
        }

        .progress-circle-container.reverse-triangle {
            /* Adjusted grid-template-areas to center the bottom circle */
            grid-template-areas: 
                "reading language ."
                ". quizzes .";
        }

        .progress-circle[data-metric="reading"] {
            grid-area: reading;
        }

        .progress-circle[data-metric="language"] {
            grid-area: language;
        }

        .progress-circle[data-metric="quizzes"] {
            grid-area: quizzes;
        }

        /* Student Card Styles */
        .student-card {
            background: #ffffff;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 4px 15px rgba(41, 128, 185, 0.08);
            text-align: center;
            position: relative;
            overflow: visible;
            display: flex;
            flex-direction: column;
            align-items: center;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            width: 100%;
        }

        .student-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(41, 128, 185, 0.12);
        }

        /* Student Avatar */
        .student-avatar {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            margin-bottom: 15px;
            background-color: #ffffff;
            background-size: cover;
            background-position: center;
            border: 3px solid #0288d1; /* Blue border */
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            transition: border 0.3s ease;
            cursor: pointer;
            box-shadow: inset 0 0 5px rgba(0,0,0,0.1);
        }

        .student-avatar:hover {
            border: 3px solid #01579b; /* Darker blue on hover */
        }

        /* Homework Completion Styles */
        .homework-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(76, 175, 80, 0.7); /* Green overlay */
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .homework-overlay.show {
            opacity: 1;
        }

        .homework-overlay::after {
            content: "‚úÖ";
            font-size: 1.8rem;
            color: white;
        }

        .student-name.completed::after {
            content: ' üèÖ';
            font-size: 1rem;
            margin-left: 5px;
        }

        .student-name {
            font-size: 1.1rem;
            font-weight: 700;
            color: #01579b;
            margin-bottom: 10px;
        }

        /* Progress Circle Styles */
        .progress-circle {
            position: relative;
            width: 40px;
            height: 40px;
            cursor: pointer;
            transition: transform 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
            margin: 0 auto;
            outline: none;
        }

        .progress-circle:focus {
            outline: none;
        }

        .progress-circle:hover,
        .progress-circle:focus {
            transform: scale(1.15);
            filter: brightness(1.1);
        }

        .progress-ring__background {
            stroke: #f5f6fa;
            stroke-width: 6;
            fill: transparent;
        }

        .progress-ring__circle {
            transition: stroke-dashoffset 1s ease-in-out;
            transform: rotate(-90deg);
            transform-origin: 50% 50%;
            stroke-dasharray: 188.4 188.4;
            stroke-dashoffset: 188.4;
            stroke-linecap: round;
        }

        /* Dynamic colors based on metric */
        .progress-circle[data-metric="reading"] .progress-ring__circle {
            stroke: #29b6f6;
        }

        .progress-circle[data-metric="language"] .progress-ring__circle {
            stroke: #26c6da;
        }

        .progress-circle[data-metric="quizzes"] .progress-ring__circle {
            stroke: #66bb6a;
        }

        .progress-circle.selected .progress-ring__circle {
            stroke: #0288d1;
            stroke-width: 4;
        }

        /* Progress Number Styles */
        .progress-number {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 0.85rem;
            font-weight: 600;
            color: #01579b;
            z-index: 2;
            line-height: 1;
        }

        /* Progress Label Styles */
        .progress-label {
            margin-top: 3px;
            font-size: 0.7rem;
            font-weight: 500;
            color: #0288d1;
            text-align: center;
            padding: 0;
            white-space: nowrap;
        }

        /* Homework Section Styles */
        .homework-section {
            display: none;
        }

        .homework-section.active,
        .progress-section.active {
            display: block;
        }

        /* Progress Tracker Section Styles */
        .progress-section {
            display: none;
        }

        .progress-section.active {
            display: block;
        }

        /* Keypad Styles */
        .keypad-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background: rgba(0, 0, 0, 0.5);
            display: none;
            z-index: 500;
            transition: opacity 0.3s ease;
        }

        .keypad {
            display: none;
            position: fixed;
            background: #ffffff;
            border-radius: 10px;
            padding: 25px;
            width: 300px;
            text-align: center;
            box-shadow: 0 4px 20px rgba(0,0,0,0.3);
            z-index: 1000;
            left: 50%;
            top: 50%;
            transform: translate(-50%, -50%);
        }

        .keypad .close-button {
            position: absolute;
            top: 10px;
            right: 15px;
            background: transparent;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: #0288d1;
        }

        .keypad .keypad-display {
            margin-bottom: 20px;
            font-size: 1.3rem;
            font-weight: bold;
            color: #01579b;
            text-align: center;
            min-height: 40px;
            border-bottom: 2px solid #0288d1;
            padding-bottom: 10px;
        }

        .keypad .keypad-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
        }

        .keypad .key {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 80px;
            height: 80px;
            font-size: 1.5rem;
            background: #81d4fa;
            color: white;
            border-radius: 10px;
            cursor: pointer;
            user-select: none;
            transition: background 0.3s;
        }

        .keypad .key:hover {
            background: #4fc3f7;
        }

        .keypad .clear {
            background: #ef5350;
        }

        .keypad .clear:hover {
            background: #e53935;
        }

        .keypad .confirm {
            background: #66bb6a;
        }

        .keypad .confirm:hover {
            background: #43a047;
        }

        /* Reset Modal Styles */
        .reset-modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.6);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1500;
            animation: fadeIn 0.6s ease-in-out;
        }

        .reset-modal {
            background-color: #ffffff;
            padding: 35px;
            border-radius: 15px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.3);
            width: 90%;
            max-width: 400px;
            text-align: center;
            position: relative;
        }

        .reset-modal h3 {
            font-size: 1.6rem;
            margin-bottom: 20px;
            color: #d32f2f;
        }

        .reset-modal input {
            width: 80%;
            padding: 12px;
            margin-bottom: 25px;
            font-size: 1rem;
            border: 2px solid #0288d1;
            border-radius: 5px;
            outline: none;
            transition: border 0.3s;
        }

        .reset-modal input:focus {
            border-color: #01579b;
        }

        .reset-modal button {
            background: linear-gradient(45deg, #d32f2f, #c62828);
            border: none;
            color: white;
            padding: 12px 25px;
            margin: 10px;
            font-size: 1rem;
            border-radius: 30px;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
            box-shadow: 0 4px 10px rgba(0,0,0,0.2);
        }

        .reset-modal button:hover {
            transform: scale(1.05);
            box-shadow: 0 6px 15px rgba(0,0,0,0.3);
        }

        /* Celebration Modal Styles */
        .celebration-modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.3);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 2100;
            animation: fadeIn 0.5s ease-in-out;
        }

        .celebration-modal {
            background-color: #ffffff;
            padding: 25px 40px;
            border-radius: 15px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.3);
            width: 80%;
            max-width: 400px;
            text-align: center;
            position: relative;
            animation: slideIn 0.5s ease-in-out;
        }

        .celebration-modal h3 {
            font-size: 1.4rem;
            margin-bottom: 15px;
            color: #43a047;
        }

        /* Uncheck All Button Styles */
        .uncheck-all-button {
            background: #ff9800;
            color: white;
            border: none;
            padding: 8px 15px;
            font-size: 0.8rem;
            border-radius: 15px;
            cursor: pointer;
            transition: background 0.3s, transform 0.2s;
            position: absolute;
            top: 20px;
            right: 20px;
        }

        .uncheck-all-button:hover {
            background: #fb8c00;
            transform: scale(1.05);
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .progress-circle {
                width: 60px;
                height: 60px;
            }

            .progress-number {
                font-size: 1rem;
            }

            .progress-label {
                font-size: 0.9rem;
            }

            .class-progress-bar {
                width: 90%;
            }

            .progress-circle-container {
                margin: 15px;
            }

            .student-card {
                width: 180px;
            }

            .modal, .reset-modal, .celebration-modal {
                padding: 25px;
            }

            .keypad {
                width: 250px;
                padding: 20px;
            }

            .keypad .key {
                width: 70px;
                height: 70px;
                font-size: 1.3rem;
            }

            .reset-modal input {
                width: 90%;
            }

            #jellyfish-game-canvas {
                width: 100%;
                height: auto;
            }
        }

        @media (max-width: 480px) {
            .progress-circle {
                width: 50px;
                height: 50px;
            }

            .progress-number {
                font-size: 0.9rem;
            }

            .progress-label {
                font-size: 0.8rem;
            }

            .class-progress-bar {
                width: 95%;
            }

            .student-card {
                width: 160px;
            }

            .keypad {
                width: 220px;
                padding: 15px;
            }

            .keypad .key {
                width: 60px;
                height: 60px;
                font-size: 1.2rem;
            }

            .reset-modal input {
                width: 100%;
            }

            #jellyfish-game-canvas {
                height: 400px;
            }
        }

        /* Ensure Progress Circles Layout */
        .progress-circle-container.reverse-triangle {
            display: grid;
            grid-template-areas: 
                "reading language ."
                ". quizzes .";
            grid-template-columns: repeat(3, 1fr);
            grid-gap: 20px;
            justify-content: center;
        }

        /* Ensure Modal Buttons are Same Size */
        .modal-buttons button {
            width: 200px;
            height: 50px;
        }

        /* Label Styles for Progress Circles */
        .progress-circle-container .progress-label {
            margin-top: 10px;
            font-size: 1rem;
            font-weight: 500;
            color: #0288d1;
            text-align: center;
        }

        /* Group Each Progress Circle with Its Label */
        .progress-circle-group {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 0;
            width: 100%;
        }

        /* Update SVG positioning */
        .progress-circle svg {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }

        /* Update Grid Container styles to be more specific */
        .homework-section .grid-container {
            display: grid;
            grid-template-columns: repeat(6, 1fr);
            gap: 15px;
            padding: 15px;
            max-width: 1400px;
            margin: 0 auto;
        }

        /* Add specific styles for homework student cards */
        .homework-section .student-card {
            padding: 15px 10px;
            min-width: 0;
        }

        .homework-section .student-avatar {
            width: 60px;
            height: 60px;
            margin-bottom: 10px;
        }

        .homework-section .student-name {
            font-size: 0.9rem;
            margin-bottom: 5px;
        }

        /* Keep original grid layout for progress section */
        .progress-section .grid-container {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 20px;
            padding: 20px;
            max-width: 1400px;
            margin: 0 auto;
        }

        /* Update Progress Circle Container */
        .progress-circle-container {
            display: grid;
            grid-template-areas: 
                "reading language ."
                ". quizzes .";
            grid-template-columns: repeat(3, 1fr);
            grid-gap: 10px;
            justify-content: center;
            margin: 10px auto;
            padding: 0;
            width: 100%;
            max-width: 160px;
        }

        /* Update Student Card Styles */
        .progress-section .student-card {
            padding: 15px 10px;
            min-width: 0;
            background: white;
            transition: transform 0.2s ease;
        }

        /* Remove all expanded/dynamic card styles */
        .progress-section .student-card:not(.expanded),
        .progress-section .student-card.expanded,
        .progress-section .student-card.dimmed {
            transform: none;
        }

        /* Update Progress Circle Styles */
        .progress-circle {
            position: relative;
            width: 40px;
            height: 40px;
            cursor: pointer;
            transition: transform 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
            margin: 0 auto;
        }

        /* Enhanced hover effect */
        .progress-circle:hover,
        .progress-circle:focus {
            transform: scale(1.15);
            filter: brightness(1.1);
        }

        /* Update SVG size to match new circle size */
        .progress-circle svg {
            width: 40px;
            height: 40px;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }

        /* Remove overlay styles */
        .progress-section .overlay {
            display: none;
        }

        /* Add these styles for progress tiers */
        .student-card {
            transition: all 0.5s ease;
        }

        .student-card[data-tier="elite"] {
            border: 2px solid #ffd700;
            background: linear-gradient(to bottom, #ffffff, #fffaf0);
        }

        .student-card[data-tier="advanced"] {
            border: 2px solid #c0c0c0;
            background: linear-gradient(to bottom, #ffffff, #f5f5f5);
        }

        .student-card[data-tier="progressive"] {
            border: 2px solid #cd7f32;
            background: linear-gradient(to bottom, #ffffff, #fff5ee);
        }

        .student-card[data-tier="developing"] {
            border: 2px solid #4682b4;
            background: linear-gradient(to bottom, #ffffff, #f0f8ff);
        }

        .student-card[data-tier="starting"] {
            border: 2px solid #dcdcdc;
        }

        /* Add progress rank indicator */
        .progress-rank {
            position: absolute;
            top: 10px;
            left: 10px;
            background: #3498db;
            color: white;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.8rem;
            font-weight: bold;
        }

        /* Add progress score display */
        .progress-score {
            font-size: 0.9rem;
            color: #666;
            margin-top: 5px;
        }

        /* Style the sort toggle button */
        .sort-toggle {
            background: none;
            color: #3498db;
            border: 1px solid #3498db;
            padding: 8px 16px;
            font-size: 0.9rem;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-bottom: 20px;
        }

        .sort-toggle:hover {
            background: #3498db;
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 2px 8px rgba(52, 152, 219, 0.2);
        }
    </style>
</head>
<body>
    <!-- Startup Modal -->
    <div class="modal-overlay" id="startup-modal">
        <div class="modal">
            <h2>Welcome! üéâ</h2>
            <p>What would you like to do today?</p>
            <div class="modal-buttons">
                <button onclick="selectOption('homework')" aria-label="Check Homework">
                    Check Homework
                </button>
                <button onclick="selectOption('progress')" aria-label="Record IXL and Read Theory Progress">
                    Record Progress
                </button>
                <!-- Removed 'Use Both' Option as per Bug Fix -->
            </div>
        </div>
    </div>

    <!-- Navigation Bar -->
    <div class="navbar">
        <div class="navbar-info">
            <span class="navbar-countdown" id="navbar-days-left"></span>
            <span class="navbar-quote" id="navbar-quote"></span>
        </div>
        <div class="navbar-buttons">
            <button id="nav-homework" class="nav-button active" onclick="toggleSection('homework')" aria-label="Navigate to Homework">
                <div class="button-content">
                    Check Homework
                </div>
            </button>
            <button id="nav-progress" class="nav-button" onclick="toggleSection('progress')" aria-label="Navigate to Progress">
                <div class="button-content">
                    Record Progress
                </div>
            </button>
            <button class="reset-button" onclick="openResetModal()" aria-label="Reset Data">üîÑ Reset</button>
        </div>
    </div>

    <!-- Countdown and Quote Sections -->
    <div class="countdown-container">
        <span id="days-left">üìÖ Only loading days left...</span>
    </div>

    <div class="quote-container">
        <span id="daily-quote">üìú Loading daily quote...</span>
    </div>

    <!-- Combined Homework and Progress Tracker Section -->
    <div id="tracker-section">
        <!-- Homework Tracker -->
        <div class="homework-section active" id="homework-section">
            <h2>üêã Narwhal Homework Tracker üìù</h2>
            <!-- Uncheck All Button -->
            <button class="uncheck-all-button" onclick="uncheckAllHomework()" aria-label="Uncheck All Homework">üóëÔ∏è Uncheck All</button>
            <div class="grid-container" id="homework-grid">
                <!-- Homework Student Cards will be dynamically generated -->
            </div>
        </div>

        <!-- Progress Tracker -->
        <div class="progress-section" id="progress-section">
            <h2>üìö IXL & Read Theory Progress Tracker üéØ</h2>
            <button class="sort-toggle" onclick="toggleSortOrder()">
                Toggle Sort Order
            </button>
            <div class="class-progress-bar">
                <div class="class-progress-fill" id="class-progress-fill"></div>
                <span class="progress-percentage" id="progress-percentage">0%</span>
            </div>
            <div class="grid-container" id="progress-grid">
                <!-- Progress Student Cards will be dynamically generated -->
            </div>
        </div>
    </div>

    <!-- Keypad Modal for Progress Tracker -->
    <div id="keypad-overlay" class="keypad-overlay" onclick="closeKeypad()"></div>
    <div id="keypad" class="keypad" role="dialog" aria-modal="true" aria-labelledby="keypad-display">
        <button class="close-button" onclick="closeKeypad()" aria-label="Close keypad">‚úñ</button>
        <div id="keypad-display" class="keypad-display" aria-live="polite"></div>
        <div class="keypad-grid">
            <div class="key" onclick="addKey('1')" tabindex="0" role="button" aria-label="Key 1">1</div>
            <div class="key" onclick="addKey('2')" tabindex="0" role="button" aria-label="Key 2">2</div>
            <div class="key" onclick="addKey('3')" tabindex="0" role="button" aria-label="Key 3">3</div>
            <div class="key" onclick="addKey('4')" tabindex="0" role="button" aria-label="Key 4">4</div>
            <div class="key" onclick="addKey('5')" tabindex="0" role="button" aria-label="Key 5">5</div>
            <div class="key" onclick="addKey('6')" tabindex="0" role="button" aria-label="Key 6">6</div>
            <div class="key" onclick="addKey('7')" tabindex="0" role="button" aria-label="Key 7">7</div>
            <div class="key" onclick="addKey('8')" tabindex="0" role="button" aria-label="Key 8">8</div>
            <div class="key" onclick="addKey('9')" tabindex="0" role="button" aria-label="Key 9">9</div>
            <div class="key clear" onclick="clearKeypad()" tabindex="0" role="button" aria-label="Clear keypad">Clear</div>
            <div class="key" onclick="addKey('0')" tabindex="0" role="button" aria-label="Key 0">0</div>
            <div class="key confirm" onclick="saveKeypad()" tabindex="0" role="button" aria-label="Confirm input">‚úî</div>
        </div>
    </div>

    <!-- Reset Modal -->
    <div class="reset-modal-overlay" id="reset-modal-overlay" onclick="closeResetModal()">
        <div class="reset-modal" onclick="event.stopPropagation()">
            <h3>üîí Enter PIN to Reset Data</h3>
            <input type="password" id="reset-pin" placeholder="Enter PIN" maxlength="4" aria-label="Reset PIN">
            <div>
                <button onclick="confirmReset()" aria-label="Confirm Reset">Reset</button>
                <button onclick="closeResetModal()" aria-label="Cancel Reset">Cancel</button>
            </div>
        </div>
    </div>

    <!-- Celebration Modal -->
    <div class="celebration-modal-overlay" id="celebration-modal-overlay">
        <div class="celebration-modal">
            <h3>üéâ All homework completed! Great job! üéâ</h3>
        </div>
    </div>

    <script>
        // Constants
        const MAX_READING = 15;
        const MAX_LANGUAGE = 15;
        const MAX_QUIZZES = 20;
        const PIN_CODE = '4296'; // For reset functionality

        // Quotes Array
        const QUOTES = [
            "Believe in yourself, you've got this! üåü",
            "Every mistake is a chance to learn something new. üìö",
            "Keep trying, your effort will pay off! üí™",
            "You are braver than you think and smarter than you know. ü¶Å",
            "A small step each day leads to big results. üèÜ",
            "Your kindness makes the world brighter. üåà",
            "Learning is an adventure‚Äîenjoy the journey! üöÄ",
            "Be proud of every progress you make, no matter how small. üå±",
            "Challenges help your brain grow stronger. üí°",
            "Your smile can light up a whole classroom! üòÑ",
            "Teamwork makes the dream work. ü§ù",
            "Stay curious and keep asking questions. üîç",
            "Your ideas matter‚Äîshare them! üí¨",
            "You are important, and your work matters. ‚≠ê",
            "Be patient and keep practicing. üé∂",
            "Mistakes show that you are trying. ‚úîÔ∏è",
            "Celebrate your victories, big and small. üéâ",
            "Be the reason someone smiles today. üòä",
            "The more you learn, the more you grow. üå≥",
            "Don't give up! Great things take time. ‚è≥",
            "You can do amazing things, one step at a time. üèÖ",
            "Your determination is powerful. ‚ö°",
            "Confidence comes from doing your best. üåû",
            "Dream big and work hard to achieve it. üåô",
            "Your uniqueness is your strength. üå∏",
            "Reading expands your imagination. üìñ",
            "Keep an open mind, discover new things. üó∫Ô∏è",
            "Practice makes you better and better. üé®",
            "Your effort is worth more than your outcome. üéà",
            "Be kind, work hard, stay humble. üíï"
        ];

        // Initialize all students with zero metrics to fix the initial data loading bug
        let students = JSON.parse(localStorage.getItem('students')) || [
            { id: 1, name: "Charlene", reading: 0, language: 0, quizzes: 0, homework: false },
            { id: 2, name: "Mieke", reading: 0, language: 0, quizzes: 0, homework: false },
            { id: 3, name: "Asa", reading: 0, language: 0, quizzes: 0, homework: false },
            { id: 4, name: "Audrea", reading: 0, language: 0, quizzes: 0, homework: false },
            { id: 5, name: "Zoe", reading: 0, language: 0, quizzes: 0, homework: false },
            { id: 6, name: "Yolanda", reading: 0, language: 0, quizzes: 0, homework: false },
            { id: 7, name: "Luna", reading: 0, language: 0, quizzes: 0, homework: false },
            { id: 8, name: "Helena", reading: 0, language: 0, quizzes: 0, homework: false },
            { id: 9, name: "Casper", reading: 0, language: 0, quizzes: 0, homework: false },
            { id: 10, name: "Angelynn", reading: 0, language: 0, quizzes: 0, homework: false },
            { id: 11, name: "Olivia Ou", reading: 0, language: 0, quizzes: 0, homework: false },
            { id: 12, name: "Hilary", reading: 0, language: 0, quizzes: 0, homework: false },
            { id: 13, name: "Olivia Lin", reading: 0, language: 0, quizzes: 0, homework: false },
            { id: 14, name: "Emily", reading: 0, language: 0, quizzes: 0, homework: false },
            { id: 15, name: "Weggis", reading: 0, language: 0, quizzes: 0, homework: false },
            { id: 16, name: "Gianna", reading: 0, language: 0, quizzes: 0, homework: false },
            { id: 17, name: "Mika", reading: 0, language: 0, quizzes: 0, homework: false },
            { id: 18, name: "Thomas", reading: 0, language: 0, quizzes: 0, homework: false },
        ];

        let activeStudent = null;
        let activeMetric = null;

        // Flags to prevent multiple alerts and confetti
        let homeworkAlertShown = false;
        let progressAlertShown = false;
        let studentConfettiTriggered = {}; // Object to track per student confetti

        // Initialize Application
        window.onload = function() {
            // Show Startup Modal
            const modal = document.getElementById('startup-modal');
            if (modal) {
                modal.style.display = 'flex';
            }

            // Set initial section visibility
            document.getElementById('homework-section').classList.add('active');
            document.getElementById('progress-section').classList.remove('active');

            // Render Sections
            renderHomework();
            renderProgress();
            displayDaysLeft();
            showDailyQuote();
        };

        // Display Days Left in the Month
        function calculateDaysLeft() {
            const now = new Date();
            const year = now.getFullYear();
            const month = now.getMonth();
            const totalDays = new Date(year, month + 1, 0).getDate();
            const today = now.getDate();
            return totalDays - today;
        }

        function displayDaysLeft() {
            const daysLeft = calculateDaysLeft();
            const mainDaysLeft = document.getElementById('days-left');
            const navbarDaysLeft = document.getElementById('navbar-days-left');
            const text = `üìÖ ${daysLeft} days left`;
            
            mainDaysLeft.textContent = text;
            navbarDaysLeft.textContent = text;
        }

        // Display Daily Quote
        function showDailyQuote() {
            if (!QUOTES.length) {
                const defaultQuote = "Stay motivated and keep learning!";
                document.getElementById('daily-quote').textContent = defaultQuote;
                document.getElementById('navbar-quote').textContent = defaultQuote;
                return;
            }
            
            const today = new Date();
            const dayOfMonth = today.getDate();
            const quoteIndex = (dayOfMonth - 1) % QUOTES.length;
            const quote = QUOTES[quoteIndex];
            
            document.getElementById('daily-quote').textContent = quote;
            document.getElementById('navbar-quote').textContent = quote;
        }

        // Save Data to Local Storage
        function saveToLocalStorage() {
            localStorage.setItem('students', JSON.stringify(students));
        }

        // Check if Student's Progress is Complete
        function isStudentComplete(student) {
            const readingPercent = Math.min((student.reading / MAX_READING) * 100, 100);
            const languagePercent = Math.min((student.language / MAX_LANGUAGE) * 100, 100);
            const quizzesPercent = Math.min((student.quizzes / MAX_QUIZZES) * 100, 100);
            return (readingPercent === 100 && languagePercent === 100 && quizzesPercent === 100);
        }

        // Confetti for Student Completion
        function triggerStudentConfetti(student) {
            confetti({
                particleCount: 100,
                spread: 70,
                origin: { y: 0.6 }
            });
        }

        // Celebrate Student Completion
        function celebrateStudentCompletion(student) {
            if (isStudentComplete(student) && !studentConfettiTriggered[student.id]) {
                triggerStudentConfetti(student);
                studentConfettiTriggered[student.id] = true;
                const studentNameElem = document.querySelector(`#progress-card-${student.id} .student-name`);
                if (studentNameElem && !studentNameElem.classList.contains('completed')) {
                    studentNameElem.classList.add('completed');
                }
            }
        }

        // Celebrate Class Completion
        function triggerMassiveConfetti() {
            confetti({
                particleCount: 300,
                spread: 70,
                origin: { y: 0.6 }
            });
        }

        // Update Class Progress Bar
        function updateClassProgressBar() {
            let totalMetrics = students.length * (MAX_READING + MAX_LANGUAGE + MAX_QUIZZES);
            let completedMetrics = 0;

            students.forEach(student => {
                completedMetrics += student.reading;
                completedMetrics += student.language;
                completedMetrics += student.quizzes;
            });

            const progressPercent = Math.round((completedMetrics / totalMetrics) * 100);
            const progressFill = document.getElementById('class-progress-fill');
            const progressPercentage = document.getElementById('progress-percentage');

            progressFill.style.width = `${progressPercent}%`;
            progressPercentage.textContent = `${progressPercent}%`;

            if (progressPercent === 100 && !progressAlertShown) {
                triggerMassiveConfetti();
                showCelebrationModal("üåü Class has achieved 100% progress! Amazing job! üåü");
                progressAlertShown = true;
            }
        }

        // Render Homework Tracker
        function renderHomework() {
            const homeworkGrid = document.getElementById('homework-grid');
            homeworkGrid.innerHTML = '';

            students.forEach(student => {
                const card = document.createElement('div');
                card.classList.add('student-card');
                card.id = `homework-card-${student.id}`;

                card.innerHTML = `
                    <div class="student-avatar" onclick="toggleHomework(${student.id})" aria-label="Mark ${student.name}'s homework as ${student.homework ? 'incomplete' : 'complete'}" tabindex="0" role="button">
                        <img src="${getAvatarURL(student.name)}" alt="${student.name}" onerror="this.style.display='none';" style="width: 100%; height: 100%; border-radius: 50%;">
                        <div class="homework-overlay" id="homework-overlay-${student.id}"></div>
                    </div>
                    <div class="student-name">${student.name}</div>
                `;
                homeworkGrid.appendChild(card);

                // Show overlay if homework is done
                if (student.homework) {
                    document.getElementById(`homework-overlay-${student.id}`).classList.add('show');
                }
            });

            checkAllHomework();
        }

        // Render Progress Tracker
        function renderProgress() {
            const progressGrid = document.getElementById('progress-grid');
            
            // Sort students by progress
            const sortedStudents = sortStudentsByProgress(students);
            
            progressGrid.innerHTML = `
                <div class="overlay"></div>
                ${sortedStudents.map((student, index) => {
                    const progressScore = calculateProgressScore(student);
                    const tier = getProgressTier(progressScore);
                    
                    return `
                        <div class="student-card" id="progress-card-${student.id}" data-tier="${tier}">
                            <div class="progress-rank">${index + 1}</div>
                            <img src="${getAvatarURL(student.name)}" alt="${student.name}" 
                                onerror="this.style.display='none';" 
                                style="width: 60px; height: 60px; border-radius: 50%; margin-bottom: 10px;">
                            <h3 class="student-name ${isStudentComplete(student) ? 'completed' : ''}">${student.name}</h3>
                            <div class="progress-score">${progressScore.toFixed(1)}%</div>
                            <div class="progress-circle-container reverse-triangle">
                                <div class="progress-circle-group">
                                    <div class="progress-circle" onclick="openKeypad(${student.id}, 'reading', this)" 
                                        data-selected="false" data-metric="reading" tabindex="0" 
                                        role="button" aria-label="Reading progress: ${student.reading} out of ${MAX_READING}">
                                        <svg class="progress-ring" width="40" height="40" viewBox="0 0 40 40">
                                            <circle class="progress-ring__background" 
                                                stroke="#f5f6fa" 
                                                stroke-width="3" 
                                                fill="transparent" 
                                                r="16" 
                                                cx="20" 
                                                cy="20"/>
                                            <circle class="progress-ring__circle" 
                                                stroke="#29b6f6" 
                                                stroke-width="3" 
                                                fill="transparent" 
                                                r="16" 
                                                cx="20" 
                                                cy="20"/>
                                        </svg>
                                        <div class="progress-number">${student.reading}</div>
                                    </div>
                                    <div class="progress-label">Reading</div>
                                </div>
                                <div class="progress-circle-group">
                                    <div class="progress-circle" onclick="openKeypad(${student.id}, 'language', this)" 
                                        data-selected="false" data-metric="language" tabindex="0" 
                                        role="button" aria-label="Language progress: ${student.language} out of ${MAX_LANGUAGE}">
                                        <svg class="progress-ring" width="40" height="40" viewBox="0 0 40 40">
                                            <circle class="progress-ring__background" 
                                                stroke="#f5f6fa" 
                                                stroke-width="3" 
                                                fill="transparent" 
                                                r="16" 
                                                cx="20" 
                                                cy="20"/>
                                            <circle class="progress-ring__circle" 
                                                stroke="#26c6da" 
                                                stroke-width="3" 
                                                fill="transparent" 
                                                r="16" 
                                                cx="20" 
                                                cy="20"/>
                                        </svg>
                                        <div class="progress-number">${student.language}</div>
                                    </div>
                                    <div class="progress-label">Language</div>
                                </div>
                                <div class="progress-circle-group">
                                    <div class="progress-circle" onclick="openKeypad(${student.id}, 'quizzes', this)" 
                                        data-selected="false" data-metric="quizzes" tabindex="0" 
                                        role="button" aria-label="Quizzes progress: ${student.quizzes} out of ${MAX_QUIZZES}">
                                        <svg class="progress-ring" width="40" height="40" viewBox="0 0 40 40">
                                            <circle class="progress-ring__background" 
                                                stroke="#f5f6fa" 
                                                stroke-width="3" 
                                                fill="transparent" 
                                                r="16" 
                                                cx="20" 
                                                cy="20"/>
                                            <circle class="progress-ring__circle" 
                                                stroke="#66bb6a" 
                                                stroke-width="3" 
                                                fill="transparent" 
                                                r="16" 
                                                cx="20" 
                                                cy="20"/>
                                        </svg>
                                        <div class="progress-number">${student.quizzes}</div>
                                    </div>
                                    <div class="progress-label">Quizzes</div>
                                </div>
                            </div>
                        </div>
                    `;
                }).join('')}
            `;
            
            // Initialize the cards after rendering
            initializeProgressCards();
            
            // Set up circular progress for each student
            students.forEach(student => {
                const card = document.getElementById(`progress-card-${student.id}`);
                if (card) {
                    setCircularProgress(card.querySelector('[data-metric="reading"]'), student.reading, MAX_READING);
                    setCircularProgress(card.querySelector('[data-metric="language"]'), student.language, MAX_LANGUAGE);
                    setCircularProgress(card.querySelector('[data-metric="quizzes"]'), student.quizzes, MAX_QUIZZES);
                }
            });
            
            // Update existing progress calculations
            updateClassProgressBar();
            checkAllProgress();
        }

        // Helper Function to Get Avatar URL (Placeholder)
        function getAvatarURL(name) {
            // Replace spaces with hyphens and convert to lowercase for URL consistency
            const formattedName = name.toLowerCase().replace(/\s+/g, '-');
            return `https://raw.githubusercontent.com/Daverose123/ixl-app/main/images/${formattedName}.jpg`;
        }

        // Toggle Homework Completion
        function toggleHomework(studentId) {
            const student = students.find(s => s.id === studentId);
            if (student) {
                student.homework = !student.homework;
                saveToLocalStorage();
                renderHomework();
                checkAllHomework();
            }
        }

        // Check if All Homework is Completed
        function checkAllHomework() {
            const allHomeworkDone = students.every(student => student.homework);
            if (allHomeworkDone && !homeworkAlertShown) {
                // Trigger confetti within the modal
                showCelebrationModal("üéâ All homework completed! Great job! üéâ");
                confetti({
                    particleCount: 200,
                    spread: 70,
                    origin: { y: 0.6 }
                });
                homeworkAlertShown = true;
            }
        }

        // Handle Option Selection from Modal
        function selectOption(option) {
            if (option === 'homework') {
                toggleSection('homework');
            } else if (option === 'progress') {
                toggleSection('progress');
            }
            // Removed 'Use Both' option as per Bug Fix
            // Close the modal
            closeStartupModal();
        }

        // Toggle Sections Based on Navigation
        function toggleSection(section) {
            const homeworkSection = document.getElementById('homework-section');
            const progressSection = document.getElementById('progress-section');
            const navHomework = document.getElementById('nav-homework');
            const navProgress = document.getElementById('nav-progress');

            if (section === 'homework') {
                homeworkSection.classList.add('active');
                progressSection.classList.remove('active');
                navHomework.classList.add('active');
                navProgress.classList.remove('active');
            } else if (section === 'progress') {
                progressSection.classList.add('active');
                homeworkSection.classList.remove('active');
                navProgress.classList.add('active');
                navHomework.classList.remove('active');
            }
        }

        // Close Startup Modal
        function closeStartupModal() {
            document.getElementById('startup-modal').style.display = 'none';
        }

        // Handle Keypad Input for Progress Tracker
        function openKeypad(studentId, metric, element) {
            activeStudent = students.find(s => s.id === studentId);
            activeMetric = metric;
            if (!activeStudent) return;

            const keypad = document.getElementById('keypad');
            const overlay = document.getElementById('keypad-overlay');
            overlay.style.display = 'block';
            keypad.style.display = 'block';
            document.getElementById('keypad-display').textContent = '';

            document.querySelectorAll('.progress-circle').forEach(circle => {
                circle.classList.remove('selected');
            });
            element.classList.add('selected');
        }

        function closeKeypad() {
            document.getElementById('keypad').style.display = 'none';
            document.getElementById('keypad-overlay').style.display = 'none';
            activeStudent = null;
            activeMetric = null;
        }

        function addKey(value) {
            const display = document.getElementById('keypad-display');
            display.textContent += value;
        }

        function clearKeypad() {
            document.getElementById('keypad-display').textContent = '';
        }

        function saveKeypad() {
            const display = document.getElementById('keypad-display');
            const value = parseInt(display.textContent, 10);
            if (!isNaN(value)) {
                activeStudent[activeMetric] = Math.min(value, getMaxMetric(activeMetric));
                saveToLocalStorage();
                renderProgress();
                updateClassProgressBar(); // Ensure the progress bar updates dynamically
            }
            closeKeypad();
        }

        function getMaxMetric(metric) {
            if (metric === 'reading') return MAX_READING;
            if (metric === 'language') return MAX_LANGUAGE;
            if (metric === 'quizzes') return MAX_QUIZZES;
            return 0;
        }

        // Set Circular Progress
        function setCircularProgress(element, value, max) {
            if (!element) return;
            
            const circle = element.querySelector('.progress-ring__circle');
            if (!circle) return;
            
            const radius = circle.r.baseVal.value;
            const circumference = 2 * Math.PI * radius;
            const percent = Math.min((value / max) * 100, 100);
            const offset = circumference - (percent / 100) * circumference;
            
            circle.style.strokeDasharray = `${circumference} ${circumference}`;
            circle.style.strokeDashoffset = offset;
        }

        // Check if All Progress is Complete
        function checkAllProgress() {
            const allProgressDone = students.every(student => isStudentComplete(student));
            if (allProgressDone && !progressAlertShown) {
                triggerMassiveConfetti();
                showCelebrationModal("üéâ All students have achieved 100%! Fantastic work! üéâ");
                progressAlertShown = true;
            }
        }

        // Reset Modal Functions
        function openResetModal() {
            document.getElementById('reset-modal-overlay').style.display = 'flex';
            document.getElementById('reset-pin').focus();
        }

        function closeResetModal() {
            document.getElementById('reset-modal-overlay').style.display = 'none';
            document.getElementById('reset-pin').value = '';
        }

        function confirmReset() {
            const enteredPin = document.getElementById('reset-pin').value;
            if (enteredPin === PIN_CODE) {
                // Reset only IXL and Read Theory data
                students.forEach(student => {
                    student.reading = 0;
                    student.language = 0;
                    student.quizzes = 0;
                    // Do not reset homework
                });
                saveToLocalStorage();
                renderProgress();
                updateClassProgressBar();

                // Reset alert flags and confetti triggers as needed
                progressAlertShown = false;
                studentConfettiTriggered = {};

                // Close the reset modal
                closeResetModal();

                // Notify user without confetti
                const modalOverlay = document.getElementById('celebration-modal-overlay');
                const modal = modalOverlay.querySelector('.celebration-modal');
                modal.querySelector('h3').textContent = "üîÑ All IXL data has been reset successfully! üìÖ";
                modalOverlay.style.display = 'flex';

                // Automatically hide after 3 seconds
                setTimeout(() => {
                    modalOverlay.style.display = 'none';
                }, 3000);
            } else {
                alert("‚ùå Incorrect PIN. Reset denied.");
            }
        }

        // Uncheck All Homework Functionality
        function uncheckAllHomework() {
            // Confirmation Prompt
            const confirmReset = confirm("Are you sure you want to uncheck all homework statuses?");
            if (confirmReset) {
                students.forEach(student => {
                    student.homework = false;
                });
                saveToLocalStorage();
                renderHomework();
                
                // Show message without confetti
                const modalOverlay = document.getElementById('celebration-modal-overlay');
                const modal = modalOverlay.querySelector('.celebration-modal');
                modal.querySelector('h3').textContent = "üóëÔ∏è All homework statuses have been cleared.";
                modalOverlay.style.display = 'flex';
                
                // Automatically hide after 3 seconds
                setTimeout(() => {
                    modalOverlay.style.display = 'none';
                }, 3000);
                
                homeworkAlertShown = false;
            }
        }

        // Keyboard Accessibility
        document.addEventListener('keydown', function(event) {
            if (event.key === 'Escape') {
                closeKeypad();
                closeResetModal();
                // closeJellyfishGame(); // Also close the game if open (Removed since game is ignored)
            }
        });

        document.querySelectorAll('.keypad .key').forEach(key => {
            key.addEventListener('keydown', function(event) {
                if (event.key === 'Enter' || event.key === ' ') {
                    event.preventDefault();
                    key.click();
                }
            });
        });

        document.querySelectorAll('.progress-circle').forEach(circle => {
            circle.addEventListener('keydown', function(event) {
                if (event.key === 'Enter' || event.key === ' ') {
                    event.preventDefault();
                    circle.click();
                }
            });
        });

        // Celebration Modal Functions
        function showCelebrationModal(message) {
            const modalOverlay = document.getElementById('celebration-modal-overlay');
            const modal = modalOverlay.querySelector('.celebration-modal');
            modal.querySelector('h3').textContent = message;
            modalOverlay.style.display = 'flex';

            // Trigger confetti above the modal
            confetti({
                particleCount: 200,
                spread: 70,
                origin: { y: 0.6 }
            });

            // Automatically hide after 5 seconds
            setTimeout(() => {
                modalOverlay.style.display = 'none';
            }, 5000);
        }

        /* ============================
           ========== FIXES ============
           ============================ */

        // Fix 1: Ensure Proper Toggle of Sections
        // - Verified that the toggleSection function correctly adds/removes the 'active' class to show/hide sections.

        // Fix 2: Adjusted Grid Layout for Progress Circles
        // - Updated the CSS grid-template-areas to center the Quizzes circle.
        // - Ensured that the progress-circle-container has three columns to properly align the circles.

        // Fix 3: Added Labels for Reading and Language
        // - Included progress labels for Reading and Language metrics to ensure all labels are displayed.

        // Fix 4: Grouped Each Progress Circle with Its Label
        // - Created a .progress-circle-group div to encapsulate each circle and its label, preventing label stacking.

        // Add these new functions
        function initializeProgressCards() {
            const cards = document.querySelectorAll('.progress-section .student-card');
            cards.forEach(card => {
                card.addEventListener('click', function(e) {
                    // Don't trigger if clicking a progress circle
                    if (e.target.closest('.progress-circle')) return;
                    
                    toggleCardExpansion(this);
                });
            });
        }

        function toggleCardExpansion(card) {
            const isExpanded = card.classList.contains('expanded');
            const overlay = document.querySelector('.progress-section .overlay');
            const allCards = document.querySelectorAll('.progress-section .student-card');
            
            if (!isExpanded) {
                // Collapse any currently expanded card
                const expandedCard = document.querySelector('.progress-section .student-card.expanded');
                if (expandedCard) {
                    expandedCard.classList.remove('expanded');
                }
                
                // Expand this card
                card.classList.add('expanded');
                overlay.classList.add('active');
                
                // Dim other cards
                allCards.forEach(otherCard => {
                    if (otherCard !== card) {
                        otherCard.classList.add('dimmed');
                    }
                });
            } else {
                // Collapse this card
                card.classList.remove('expanded');
                overlay.classList.remove('active');
                
                // Remove dimming from all cards
                allCards.forEach(otherCard => {
                    otherCard.classList.remove('dimmed');
                });
            }
        }

        // Add click handler for overlay
        document.addEventListener('DOMContentLoaded', function() {
            const overlay = document.querySelector('.progress-section .overlay');
            overlay.addEventListener('click', function() {
                const expandedCard = document.querySelector('.progress-section .student-card.expanded');
                if (expandedCard) {
                    toggleCardExpansion(expandedCard);
                }
            });
        });

        // Add this JavaScript function
        function handleScroll() {
            const navbar = document.querySelector('.navbar');
            const navbarInfo = document.querySelector('.navbar-info');
            const navbarButtons = document.querySelector('.navbar-buttons');
            const countdownContainer = document.querySelector('.countdown-container');
            const quoteContainer = document.querySelector('.quote-container');
            
            // Get scroll position
            const scrollPosition = window.scrollY;
            
            // Define when to trigger the change (e.g., after scrolling 100px)
            if (scrollPosition > 100) {
                // Move info to navbar
                navbar.classList.add('scrolled');
                navbarInfo.style.display = 'flex';
                
                // Hide original containers
                countdownContainer.style.visibility = 'hidden';
                quoteContainer.style.visibility = 'hidden';
            } else {
                // Revert to original state
                navbar.classList.remove('scrolled');
                navbarInfo.style.display = 'none';
                
                // Show original containers
                countdownContainer.style.visibility = 'visible';
                quoteContainer.style.visibility = 'visible';
            }
        }

        // Add scroll event listener
        window.addEventListener('scroll', handleScroll);

        // Calculate total progress score for a student
        function calculateProgressScore(student) {
            // Weighted scoring (35% reading, 35% language, 30% quizzes)
            const readingScore = (student.reading / MAX_READING) * 35;
            const languageScore = (student.language / MAX_LANGUAGE) * 35;
            const quizzesScore = (student.quizzes / MAX_QUIZZES) * 30;
            return readingScore + languageScore + quizzesScore;
        }

        // Calculate balance score (how evenly distributed the progress is)
        function calculateBalanceScore(student) {
            const readingPercent = (student.reading / MAX_READING) * 100;
            const languagePercent = (student.language / MAX_LANGUAGE) * 100;
            const quizzesPercent = (student.quizzes / MAX_QUIZZES) * 100;
            
            const mean = (readingPercent + languagePercent + quizzesPercent) / 3;
            const variance = Math.pow(readingPercent - mean, 2) + 
                            Math.pow(languagePercent - mean, 2) + 
                            Math.pow(quizzesPercent - mean, 2);
            
            // Return inverse of standard deviation (higher is better)
            return 100 - Math.sqrt(variance / 3);
        }

        // Get progress tier for visual grouping
        function getProgressTier(score) {
            if (score >= 90) return 'elite';
            if (score >= 75) return 'advanced';
            if (score >= 50) return 'progressive';
            if (score >= 25) return 'developing';
            return 'starting';
        }

        // Sort students by progress
        function sortStudentsByProgress(students) {
            const sorted = [...students].sort((a, b) => {
                // Primary sort: Total progress
                const scoreA = calculateProgressScore(a);
                const scoreB = calculateProgressScore(b);
                
                if (scoreA !== scoreB) {
                    return scoreB - scoreA;
                }
                
                // Tiebreaker 1: Balance score
                const balanceA = calculateBalanceScore(a);
                const balanceB = calculateBalanceScore(b);
                
                if (balanceA !== balanceB) {
                    return balanceB - balanceA;
                }
                
                // Final tiebreaker: Alphabetical
                return a.name.localeCompare(b.name);
            });
            
            return isReverseSorted ? sorted.reverse() : sorted;
        }

        let isReverseSorted = false;

        function toggleSortOrder() {
            isReverseSorted = !isReverseSorted;
            renderProgress();
        }
    </script>
</body>
</html>
