<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üêã Narwhal Homework & Progress Tracker üìöüéØ</title>
    <!-- Confetti Library -->
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.5.1/dist/confetti.browser.min.js"></script>
    <!-- Google Fonts for Professional Typography -->
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&display=swap" rel="stylesheet">
    <!-- Font Awesome for Icons -->
    <script src="https://kit.fontawesome.com/a076d05399.js" crossorigin="anonymous"></script>
    <style>
        /* General Styles */
        body {
            font-family: 'Montserrat', sans-serif; /* Updated Font */
            background: linear-gradient(to bottom, #e0f7fa, #b2ebf2); /* Subtle underwater gradient */
            margin: 0;
            padding: 0;
            text-align: center;
            box-sizing: border-box;
            color: #01579b; /* Dark blue for text */
            overflow-x: hidden;
        }

        /* Startup Modal Styles */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(1, 87, 155, 0.85); /* Semi-transparent dark blue */
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            animation: fadeIn 0.6s ease-in-out;
        }

        .modal {
            background-color: #ffffff;
            padding: 40px;
            border-radius: 15px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.3);
            width: 90%;
            max-width: 500px;
            text-align: center;
            position: relative;
            display: flex;
            flex-direction: column;
            align-items: center; /* Center buttons */
        }

        .modal h2 {
            font-size: 2rem;
            margin-bottom: 20px;
            color: #0288d1; /* Blue */
        }

        .modal p {
            font-size: 1.1rem;
            margin-bottom: 30px;
            color: #0277bd; /* Slightly darker blue */
        }

        .modal-buttons {
            display: flex;
            flex-direction: column; /* Stack buttons vertically */
            align-items: center;
            gap: 15px; /* Space between buttons */
            width: 100%;
        }

        /* For larger screens, arrange buttons horizontally */
        @media (min-width: 600px) {
            .modal-buttons {
                flex-direction: row;
                justify-content: center;
            }
        }

        .modal-buttons button {
            width: 80%;
            max-width: 200px;
            background: linear-gradient(45deg, #0288d1, #01579b); /* Blue gradient */
            border: none;
            color: white;
            padding: 15px 25px;
            font-size: 1rem;
            border-radius: 30px;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
            display: flex;
            align-items: center;
            gap: 10px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.2);
        }

        .modal-buttons button:hover {
            transform: scale(1.05);
            box-shadow: 0 6px 15px rgba(0,0,0,0.3);
        }

        /* Animations */
        @keyframes fadeIn {
            from { opacity: 0; transform: scale(0.8); }
            to { opacity: 1; transform: scale(1); }
        }

        @keyframes slideIn {
            from { opacity: 0; transform: translateY(-20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes rotateBackground {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        @keyframes backgroundShift {
            0% { background: linear-gradient(135deg, #b3e5fc, #81d4fa); }
            50% { background: linear-gradient(135deg, #81d4fa, #4fc3f7); }
            100% { background: linear-gradient(135deg, #b3e5fc, #81d4fa); }
        }

        /* Navigation Bar Styles */
        .navbar {
            background: linear-gradient(90deg, #0288d1, #01579b); /* Modern blue gradient */
            padding: 15px 0;
            position: sticky;
            top: 0;
            z-index: 900;
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 20px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            transition: background 0.5s;
        }

        .navbar button {
            background: rgba(255, 255, 255, 0.2);
            border: none;
            color: white;
            font-size: 1rem;
            cursor: pointer;
            transition: background 0.3s, transform 0.3s;
            padding: 10px 20px;
            border-radius: 25px;
            display: flex;
            align-items: center;
            gap: 8px;
            position: relative;
        }

        .navbar button.active, .navbar button:hover {
            background: rgba(255, 255, 255, 0.4);
            transform: scale(1.05);
        }

        /* Reset Button Styles */
        .navbar .reset-button {
            background: #ffeb3b; /* Yellow for visibility */
            color: #01579b; /* Dark blue text */
            font-weight: bold;
        }

        .navbar .reset-button:hover {
            background: #fdd835; /* Darker yellow on hover */
        }

        /* Countdown and Quote Styles */
        .countdown-container, .quote-container {
            margin: 25px auto;
            padding: 15px;
            max-width: 800px;
            text-align: center;
        }

        .countdown-container span, .quote-container span {
            font-size: 1.3rem;
            font-weight: bold;
            display: block;
            margin-bottom: 10px;
            color: #0288d1; /* Blue */
        }

        .quote-container {
            font-style: italic;
            font-size: 1.1rem;
            color: #0277bd; /* Slightly darker blue */
            padding: 20px;
            background: linear-gradient(135deg, #b3e5fc, #81d4fa); /* Soft gradient */
            border-radius: 15px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            position: relative;
            overflow: hidden;
            opacity: 0; /* Initial state for animation */
            transform: translateY(10px) scale(0.98); /* Initial transform for animation */
            transition: transform 0.5s ease, opacity 0.5s ease; /* Transition properties */
            animation: backgroundShift 20s ease-in-out infinite; /* Background animation */
        }

        .quote-container.visible {
            opacity: 1;
            transform: translateY(0) scale(1);
        }

        .quote-container::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255,255,255,0.2) 20%, transparent 80%);
            transform: rotate(45deg);
            animation: rotateBackground 10s linear infinite;
        }

        /* Progress and Homework Section Styles */
        .progress-section, .homework-section {
            margin: 25px auto;
            padding: 25px;
            max-width: 1200px;
            text-align: center;
            background-color: rgba(225, 245, 254, 0.9); /* Very light blue with transparency */
            border-radius: 15px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            animation: fadeIn 1s ease-in-out;
        }

        .progress-section h2, .homework-section h2 {
            font-size: 1.8rem;
            margin-bottom: 25px;
            color: #01579b; /* Dark blue */
            position: relative;
            display: inline-block;
        }

        .progress-section h2::after, .homework-section h2::after {
            content: '';
            position: absolute;
            width: 50px;
            height: 3px;
            background-color: #0288d1;
            left: 50%;
            bottom: -10px;
            transform: translateX(-50%);
            border-radius: 2px;
        }

        /* Class Progress Bar */
        .class-progress-bar {
            position: relative;
            width: 80%;
            height: 25px;
            background-color: #81d4fa; /* Light blue */
            border-radius: 12.5px;
            margin: 0 auto 30px auto;
            overflow: hidden;
            box-shadow: inset 0 1px 3px rgba(0,0,0,0.2);
        }

        .class-progress-fill {
            position: absolute;
            left: 0;
            top: 0;
            width: 0%;
            height: 100%;
            background: linear-gradient(90deg, #0288d1, #01579b); /* Blue gradient */
            border-radius: 12.5px;
            transition: width 0.5s ease-in-out; /* Smooth transition */
        }

        .progress-percentage {
            position: absolute;
            width: 100%;
            top: 0;
            left: 0;
            text-align: center;
            color: #ffffff;
            font-weight: bold;
            line-height: 25px; /* Match the height of the progress bar */
        }

        /* Grid Container */
        .grid-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
            gap: 25px;
            padding: 20px;
            max-width: 1200px;
            margin: 0 auto;
        }

        /* Progress Circle Container */
        .progress-circle-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin: 20px;
        }

        /* Student Card Styles */
        .student-card {
            background: linear-gradient(135deg, #bbdefb, #e3f2fd); /* Light blue gradient */
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
            text-align: center;
            position: relative;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            align-items: center;
            transition: transform 0.3s, box-shadow 0.3s;
        }

        .student-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 20px rgba(0,0,0,0.15);
        }

        /* Student Avatar */
        .student-avatar {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            margin-bottom: 15px;
            background-color: #ffffff;
            background-size: cover;
            background-position: center;
            border: 3px solid #0288d1; /* Blue border */
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            transition: border 0.3s ease;
            cursor: pointer;
            box-shadow: inset 0 0 5px rgba(0,0,0,0.1);
        }

        .student-avatar:hover {
            border: 3px solid #01579b; /* Darker blue on hover */
        }

        /* Homework Completion Styles */
        .homework-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(76, 175, 80, 0.7); /* Green overlay */
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .homework-overlay.show {
            opacity: 1;
        }

        .homework-overlay::after {
            content: "‚úÖ";
            font-size: 1.8rem;
            color: white;
        }

        .student-name.completed::after {
            content: ' üèÖ';
            font-size: 1rem;
            margin-left: 5px;
        }

        .student-name {
            font-size: 1.1rem;
            font-weight: 700;
            color: #01579b;
            margin-bottom: 10px;
        }

        /* Progress Circle Styles */
        .progress-circle {
            position: relative;
            width: 80px;
            height: 80px;
            cursor: pointer;
            transition: transform 0.3s, box-shadow 0.3s;
            outline: none; /* Remove default focus outline */
        }

        .progress-circle:hover,
        .progress-circle:focus {
            transform: scale(1.1);
            box-shadow: 0 0 15px rgba(0, 0, 0, 0.2);
        }

        .progress-ring__background {
            stroke: #b3e5fc; /* Very light blue */
            stroke-width: 8;
            fill: transparent;
        }

        .progress-ring__circle {
            transition: stroke-dashoffset 1s ease-in-out;
            transform: rotate(-90deg);
            transform-origin: 50% 50%;
            stroke-dasharray: 188.4 188.4; /* 2 * PI * 30 */
            stroke-dashoffset: 188.4;
            stroke-linecap: round; /* Rounded ends */
        }

        /* Dynamic colors based on metric */
        .progress-circle[data-metric="reading"] .progress-ring__circle {
            stroke: #29b6f6; /* Blue */
        }

        .progress-circle[data-metric="language"] .progress-ring__circle {
            stroke: #26c6da; /* Teal */
        }

        .progress-circle[data-metric="quizzes"] .progress-ring__circle {
            stroke: #66bb6a; /* Green */
        }

        .progress-circle.selected .progress-ring__circle {
            stroke: #0288d1; /* Dark blue when selected */
            stroke-width: 10;
        }

        /* Progress Number Styles */
        .progress-number {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 1.2rem;
            font-weight: 700;
            color: #01579b; /* Dark blue */
        }

        /* Progress Label Styles */
        .progress-label {
            margin-top: 10px;
            font-size: 1rem;
            font-weight: 500;
            color: #0288d1; /* Blue */
            text-align: center;
        }

        /* Homework Section Styles */
        .homework-section {
            display: none; /* Hidden by default */
        }

        .homework-section.active {
            display: block;
        }

        /* IXL Progress Section Styles */
        .progress-section {
            display: none; /* Hidden by default */
        }

        .progress-section.active {
            display: block;
        }

        /* Keypad Styles */
        .keypad-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background: rgba(0, 0, 0, 0.5);
            display: none;
            z-index: 500;
            transition: opacity 0.3s ease;
        }

        .keypad {
            display: none;
            position: fixed;
            background: #ffffff;
            border-radius: 10px;
            padding: 25px;
            width: 300px;
            text-align: center;
            box-shadow: 0 4px 20px rgba(0,0,0,0.3);
            z-index: 1000;
            left: 50%;
            top: 50%;
            transform: translate(-50%, -50%);
            /* Removed pan animation */
        }

        .keypad .close-button {
            position: absolute;
            top: 10px;
            right: 15px;
            background: transparent;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: #0288d1;
        }

        .keypad .keypad-display {
            margin-bottom: 20px;
            font-size: 1.3rem;
            font-weight: bold;
            color: #01579b;
            text-align: center;
            min-height: 40px;
            border-bottom: 2px solid #0288d1;
            padding-bottom: 10px;
        }

        .keypad .keypad-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
        }

        .keypad .key {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 80px;
            height: 80px;
            font-size: 1.5rem;
            background: #81d4fa; /* Light blue */
            color: white;
            border-radius: 10px;
            cursor: pointer;
            user-select: none;
            transition: background 0.3s;
        }

        .keypad .key:hover {
            background: #4fc3f7; /* Slightly darker blue on hover */
        }

        .keypad .clear {
            background: #ef5350; /* Red */
        }

        .keypad .clear:hover {
            background: #e53935; /* Darker red on hover */
        }

        .keypad .confirm {
            background: #66bb6a; /* Green */
        }

        .keypad .confirm:hover {
            background: #43a047; /* Darker green on hover */
        }

        /* Reset Modal Styles */
        .reset-modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.6);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1500;
            animation: fadeIn 0.6s ease-in-out;
        }

        .reset-modal {
            background-color: #ffffff;
            padding: 35px;
            border-radius: 15px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.3);
            width: 90%;
            max-width: 400px;
            text-align: center;
            position: relative;
        }

        .reset-modal h3 {
            font-size: 1.6rem;
            margin-bottom: 20px;
            color: #d32f2f; /* Red */
        }

        .reset-modal input {
            width: 80%;
            padding: 12px;
            margin-bottom: 25px;
            font-size: 1rem;
            border: 2px solid #0288d1; /* Blue border */
            border-radius: 5px;
            outline: none;
            transition: border 0.3s;
        }

        .reset-modal input:focus {
            border-color: #01579b; /* Darker blue on focus */
        }

        .reset-modal button {
            background: linear-gradient(45deg, #d32f2f, #c62828); /* Red gradient */
            border: none;
            color: white;
            padding: 12px 25px;
            margin: 10px;
            font-size: 1rem;
            border-radius: 30px;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
            box-shadow: 0 4px 10px rgba(0,0,0,0.2);
        }

        .reset-modal button:hover {
            transform: scale(1.05);
            box-shadow: 0 6px 15px rgba(0,0,0,0.3);
        }

        /* Celebration Modal Styles */
        .celebration-modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.3);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1600;
            animation: fadeIn 0.5s ease-in-out;
        }

        .celebration-modal {
            background-color: #ffffff;
            padding: 25px 40px;
            border-radius: 15px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.3);
            width: 80%;
            max-width: 400px;
            text-align: center;
            position: relative;
            animation: slideIn 0.5s ease-in-out;
        }

        .celebration-modal h3 {
            font-size: 1.4rem;
            margin-bottom: 15px;
            color: #43a047; /* Green */
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .progress-circle {
                width: 60px;
                height: 60px;
            }

            .progress-number {
                font-size: 1rem;
            }

            .progress-label {
                font-size: 0.9rem;
            }

            .class-progress-bar {
                width: 90%;
            }

            .progress-circle-container {
                margin: 15px;
            }

            .student-card {
                width: 180px;
            }

            .modal, .reset-modal, .celebration-modal {
                padding: 25px;
            }

            .keypad {
                width: 250px;
                padding: 20px;
            }

            .keypad .key {
                width: 70px;
                height: 70px;
                font-size: 1.3rem;
            }

            .reset-modal input {
                width: 90%;
            }
        }

        @media (max-width: 480px) {
            .progress-circle {
                width: 50px;
                height: 50px;
            }

            .progress-number {
                font-size: 0.9rem;
            }

            .progress-label {
                font-size: 0.8rem;
            }

            .class-progress-bar {
                width: 95%;
            }

            .student-card {
                width: 160px;
            }

            .keypad {
                width: 220px;
                padding: 15px;
            }

            .keypad .key {
                width: 60px;
                height: 60px;
                font-size: 1.2rem;
            }

            .reset-modal input {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <!-- Startup Modal -->
    <div class="modal-overlay" id="startup-modal">
        <div class="modal">
            <h2>Welcome! üéâ</h2>
            <p>What would you like to do today?</p>
            <div class="modal-buttons">
                <button onclick="selectOption('homework')" aria-label="Check Homework">
                    üìù Check Homework
                </button>
                <button onclick="selectOption('progress')" aria-label="Record IXL and Read Theory Progress">
                    üìà Record Progress
                </button>
                <!-- Removed 'Use Both' Option as per Bug Fix -->
            </div>
        </div>
    </div>

    <!-- Navigation Bar -->
    <div class="navbar">
        <button id="nav-homework" onclick="toggleSection('homework')" class="active">üìù Homework</button>
        <button id="nav-progress" onclick="toggleSection('progress')">üìà Progress</button>
        <button class="reset-button" onclick="openResetModal()" aria-label="Reset Data">üîÑ Reset Data</button>
    </div>

    <!-- Countdown and Quote Sections -->
    <div class="countdown-container">
        <span id="days-left">üìÖ Only loading days left...</span>
    </div>

    <div class="quote-container" id="quote-container">
        <span id="daily-quote">üìú Loading daily quote...</span>
    </div>

    <!-- Combined Homework and Progress Tracker Section -->
    <div id="tracker-section">
        <!-- Homework Tracker -->
        <div class="homework-section active" id="homework-section">
            <h2>üêã Narwhal Homework Tracker üìù</h2>
            <div class="grid-container" id="homework-grid">
                <!-- Homework Student Cards will be dynamically generated -->
            </div>
        </div>

        <!-- Progress Tracker -->
        <div class="progress-section active" id="progress-section">
            <h2>üìö IXL & Read Theory Progress Tracker üéØ</h2>
            <div class="class-progress-bar">
                <div class="class-progress-fill" id="class-progress-fill"></div>
                <span class="progress-percentage" id="progress-percentage">0%</span>
            </div>
            <div class="grid-container" id="progress-grid">
                <!-- Progress Student Cards will be dynamically generated -->
            </div>
        </div>
    </div>

    <!-- Keypad Modal for Progress Tracker -->
    <div id="keypad-overlay" class="keypad-overlay" onclick="closeKeypad()"></div>
    <div id="keypad" class="keypad" role="dialog" aria-modal="true" aria-labelledby="keypad-display">
        <button class="close-button" onclick="closeKeypad()" aria-label="Close keypad">‚úñ</button>
        <div id="keypad-display" class="keypad-display" aria-live="polite"></div>
        <div class="keypad-grid">
            <div class="key" onclick="addKey('1')" tabindex="0" role="button" aria-label="Key 1">1</div>
            <div class="key" onclick="addKey('2')" tabindex="0" role="button" aria-label="Key 2">2</div>
            <div class="key" onclick="addKey('3')" tabindex="0" role="button" aria-label="Key 3">3</div>
            <div class="key" onclick="addKey('4')" tabindex="0" role="button" aria-label="Key 4">4</div>
            <div class="key" onclick="addKey('5')" tabindex="0" role="button" aria-label="Key 5">5</div>
            <div class="key" onclick="addKey('6')" tabindex="0" role="button" aria-label="Key 6">6</div>
            <div class="key" onclick="addKey('7')" tabindex="0" role="button" aria-label="Key 7">7</div>
            <div class="key" onclick="addKey('8')" tabindex="0" role="button" aria-label="Key 8">8</div>
            <div class="key" onclick="addKey('9')" tabindex="0" role="button" aria-label="Key 9">9</div>
            <div class="key clear" onclick="clearKeypad()" tabindex="0" role="button" aria-label="Clear keypad">Clear</div>
            <div class="key" onclick="addKey('0')" tabindex="0" role="button" aria-label="Key 0">0</div>
            <div class="key confirm" onclick="saveKeypad()" tabindex="0" role="button" aria-label="Confirm input">‚úî</div>
        </div>
    </div>

    <!-- Reset Modal -->
    <div class="reset-modal-overlay" id="reset-modal-overlay" onclick="closeResetModal()">
        <div class="reset-modal" onclick="event.stopPropagation()">
            <h3>üîí Enter PIN to Reset Data</h3>
            <input type="password" id="reset-pin" placeholder="Enter PIN" maxlength="4" aria-label="Reset PIN">
            <div>
                <button onclick="confirmReset()" aria-label="Confirm Reset">Reset</button>
                <button onclick="closeResetModal()" aria-label="Cancel Reset">Cancel</button>
            </div>
        </div>
    </div>

    <!-- Celebration Modal -->
    <div class="celebration-modal-overlay" id="celebration-modal-overlay">
        <div class="celebration-modal">
            <h3>üéâ All homework completed! Great job! üéâ</h3>
        </div>
    </div>

    <script>
        // Constants
        const MAX_READING = 15;
        const MAX_LANGUAGE = 15;
        const MAX_QUIZZES = 20;
        const PIN_CODE = '4296'; // For reset functionality

        // Quotes Array
        const QUOTES = [
            "Believe in yourself, you‚Äôve got this! üåü",
            "Every mistake is a chance to learn something new. üìö",
            "Keep trying, your effort will pay off! üí™",
            "You are braver than you think and smarter than you know. ü¶Å",
            "A small step each day leads to big results. üèÜ",
            "Your kindness makes the world brighter. üåà",
            "Learning is an adventure‚Äîenjoy the journey! üöÄ",
            "Be proud of every progress you make, no matter how small. üå±",
            "Challenges help your brain grow stronger. üí°",
            "Your smile can light up a whole classroom! üòÑ",
            "Teamwork makes the dream work. ü§ù",
            "Stay curious and keep asking questions. üîç",
            "Your ideas matter‚Äîshare them! üí¨",
            "You are important, and your work matters. ‚≠ê",
            "Be patient and keep practicing. üé∂",
            "Mistakes show that you are trying. ‚úîÔ∏è",
            "Celebrate your victories, big and small. üéâ",
            "Be the reason someone smiles today. üòä",
            "The more you learn, the more you grow. üå≥",
            "Don‚Äôt give up! Great things take time. ‚è≥",
            "You can do amazing things, one step at a time. üèÖ",
            "Your determination is powerful. ‚ö°",
            "Confidence comes from doing your best. üåû",
            "Dream big and work hard to achieve it. üåô",
            "Your uniqueness is your strength. üå∏",
            "Reading expands your imagination. üìñ",
            "Keep an open mind, discover new things. üó∫Ô∏è",
            "Practice makes you better and better. üé®",
            "Your effort is worth more than your outcome. üéà",
            "Be kind, work hard, stay humble. üíï"
        ];

        // Initialize all students with zero metrics to fix the initial data loading bug
        let students = JSON.parse(localStorage.getItem('students')) || [
            { id: 1, name: "Charlene", reading: 0, language: 0, quizzes: 0, homework: false },
            { id: 2, name: "Mieke", reading: 0, language: 0, quizzes: 0, homework: false },
            { id: 3, name: "Asa", reading: 0, language: 0, quizzes: 0, homework: false },
            { id: 4, name: "Audrea", reading: 0, language: 0, quizzes: 0, homework: false },
            { id: 5, name: "Zoe", reading: 0, language: 0, quizzes: 0, homework: false },
            { id: 6, name: "Yolanda", reading: 0, language: 0, quizzes: 0, homework: false },
            { id: 7, name: "Luna", reading: 0, language: 0, quizzes: 0, homework: false },
            { id: 8, name: "Helena", reading: 0, language: 0, quizzes: 0, homework: false },
            { id: 9, name: "Casper", reading: 0, language: 0, quizzes: 0, homework: false },
            { id: 10, name: "Angelynn", reading: 0, language: 0, quizzes: 0, homework: false },
            { id: 11, name: "Olivia Ou", reading: 0, language: 0, quizzes: 0, homework: false },
            { id: 12, name: "Hilary", reading: 0, language: 0, quizzes: 0, homework: false },
            { id: 13, name: "Olivia Lin", reading: 0, language: 0, quizzes: 0, homework: false },
            { id: 14, name: "Emily", reading: 0, language: 0, quizzes: 0, homework: false },
            { id: 15, name: "Weggis", reading: 0, language: 0, quizzes: 0, homework: false },
            { id: 16, name: "Gianna", reading: 0, language: 0, quizzes: 0, homework: false },
            { id: 17, name: "Mika", reading: 0, language: 0, quizzes: 0, homework: false },
            { id: 18, name: "Thomas", reading: 0, language: 0, quizzes: 0, homework: false },
        ];

        let activeStudent = null;
        let activeMetric = null;

        // Flags to prevent multiple alerts and confetti
        let homeworkAlertShown = false;
        let progressAlertShown = false;
        let studentConfettiTriggered = {}; // Object to track per student confetti

        // Initialize Application
        window.onload = function() {
            // Show Startup Modal
            const modal = document.getElementById('startup-modal');
            if (modal) {
                modal.style.display = 'flex';
            }

            // Render Sections
            renderHomework();
            renderProgress();
            displayDaysLeft();
            showDailyQuote();
        };

        // Display Days Left in the Month
        function calculateDaysLeft() {
            const now = new Date();
            const year = now.getFullYear();
            const month = now.getMonth();
            const totalDays = new Date(year, month + 1, 0).getDate();
            const today = now.getDate();
            return totalDays - today;
        }

        function displayDaysLeft() {
            const daysLeft = calculateDaysLeft();
            const daysLeftElem = document.getElementById('days-left');
            daysLeftElem.textContent = `üìÖ Only ${daysLeft} day${daysLeft !== 1 ? 's' : ''} left this month! Keep going! üéâ`;
        }

        // Display Daily Quote
        function showDailyQuote() {
            if (!QUOTES.length) {
                document.getElementById('daily-quote').textContent = "üìú Stay motivated and keep learning!";
                return;
            }
            const today = new Date();
            const dayOfMonth = today.getDate();
            const quoteIndex = (dayOfMonth - 1) % QUOTES.length;
            const quoteElement = document.getElementById('daily-quote');

            // Remove 'visible' class to trigger fade-out
            quoteElement.parentElement.classList.remove('visible');

            // Allow time for fade-out
            setTimeout(() => {
                quoteElement.textContent = QUOTES[quoteIndex];
                quoteElement.parentElement.classList.add('visible');
            }, 500); // Half of the transition duration
        }

        // Save Data to Local Storage
        function saveToLocalStorage() {
            localStorage.setItem('students', JSON.stringify(students));
        }

        // Check if Student's Progress is Complete
        function isStudentComplete(student) {
            const readingPercent = Math.min((student.reading / MAX_READING) * 100, 100);
            const languagePercent = Math.min((student.language / MAX_LANGUAGE) * 100, 100);
            const quizzesPercent = Math.min((student.quizzes / MAX_QUIZZES) * 100, 100);
            return (readingPercent === 100 && languagePercent === 100 && quizzesPercent === 100);
        }

        // Confetti for Student Completion
        function triggerStudentConfetti(student) {
            confetti({
                particleCount: 100,
                spread: 70,
                origin: { y: 0.6 }
            });
        }

        // Celebrate Student Completion
        function celebrateStudentCompletion(student) {
            if (isStudentComplete(student) && !studentConfettiTriggered[student.id]) {
                triggerStudentConfetti(student);
                studentConfettiTriggered[student.id] = true;
                const studentNameElem = document.querySelector(`#progress-card-${student.id} .student-name`);
                if (studentNameElem && !studentNameElem.classList.contains('completed')) {
                    studentNameElem.classList.add('completed');
                }
            }
        }

        // Celebrate Class Completion
        function triggerMassiveConfetti() {
            confetti({
                particleCount: 300,
                spread: 70,
                origin: { y: 0.6 }
            });
        }

        // Update Class Progress Bar
        function updateClassProgressBar() {
            let totalMetrics = students.length * (MAX_READING + MAX_LANGUAGE + MAX_QUIZZES);
            let completedMetrics = 0;

            students.forEach(student => {
                completedMetrics += student.reading;
                completedMetrics += student.language;
                completedMetrics += student.quizzes;
            });

            const progressPercent = Math.round((completedMetrics / totalMetrics) * 100);
            const progressFill = document.getElementById('class-progress-fill');
            const progressPercentage = document.getElementById('progress-percentage');

            progressFill.style.width = `${progressPercent}%`;
            progressPercentage.textContent = `${progressPercent}%`;

            if (progressPercent === 100 && !progressAlertShown) {
                triggerMassiveConfetti();
                showCelebrationModal("üåü Class has achieved 100% progress! Amazing job! üåü");
                progressAlertShown = true;
            }
        }

        // Render Homework Tracker
        function renderHomework() {
            const homeworkGrid = document.getElementById('homework-grid');
            homeworkGrid.innerHTML = '';

            students.forEach(student => {
                const card = document.createElement('div');
                card.classList.add('student-card');
                card.id = `homework-card-${student.id}`;

                card.innerHTML = `
                    <div class="student-avatar" onclick="toggleHomework(${student.id})" aria-label="Mark ${student.name}'s homework as ${student.homework ? 'incomplete' : 'complete'}" tabindex="0" role="button">
                        <img src="${getAvatarURL(student.name)}" alt="${student.name}" onerror="this.src='default-avatar.png'" style="width: 100%; height: 100%; border-radius: 50%;">
                        <div class="homework-overlay" id="homework-overlay-${student.id}"></div>
                    </div>
                    <div class="student-name">${student.name}</div>
                `;
                homeworkGrid.appendChild(card);

                // Show overlay if homework is done
                if (student.homework) {
                    document.getElementById(`homework-overlay-${student.id}`).classList.add('show');
                }
            });

            checkAllHomework();
        }

        // Render Progress Tracker
        function renderProgress() {
            const progressGrid = document.getElementById('progress-grid');
            progressGrid.innerHTML = '';

            students.forEach(student => {
                const card = document.createElement('div');
                card.classList.add('student-card');
                card.id = `progress-card-${student.id}`;

                card.innerHTML = `
                    <img src="${getAvatarURL(student.name)}" alt="${student.name}" onerror="this.src='default-avatar.png'" style="width: 80px; height: 80px; border-radius: 50%; object-fit: cover;">
                    <h3 class="student-name">${student.name}</h3>
                    <div class="progress-circle-container">
                        <div class="progress-circle" onclick="openKeypad(${student.id}, 'reading', this)" data-selected="false" data-metric="reading" tabindex="0" role="button" aria-label="Reading progress: ${student.reading} out of ${MAX_READING}">
                            <svg class="progress-ring" width="80" height="80">
                                <circle class="progress-ring__background" stroke="#b3e5fc" stroke-width="8" fill="transparent" r="30" cx="40" cy="40"/>
                                <circle class="progress-ring__circle" stroke="#29b6f6" stroke-width="8" fill="transparent" r="30" cx="40" cy="40"/>
                            </svg>
                            <div class="progress-number">${student.reading}</div>
                        </div>
                        <div class="progress-label">Reading</div>
                        <div class="progress-circle" onclick="openKeypad(${student.id}, 'language', this)" data-selected="false" data-metric="language" tabindex="0" role="button" aria-label="Language progress: ${student.language} out of ${MAX_LANGUAGE}">
                            <svg class="progress-ring" width="80" height="80">
                                <circle class="progress-ring__background" stroke="#b3e5fc" stroke-width="8" fill="transparent" r="30" cx="40" cy="40"/>
                                <circle class="progress-ring__circle" stroke="#26c6da" stroke-width="8" fill="transparent" r="30" cx="40" cy="40"/>
                            </svg>
                            <div class="progress-number">${student.language}</div>
                        </div>
                        <div class="progress-label">Language</div>
                        <div class="progress-circle" onclick="openKeypad(${student.id}, 'quizzes', this)" data-selected="false" data-metric="quizzes" tabindex="0" role="button" aria-label="Quizzes progress: ${student.quizzes} out of ${MAX_QUIZZES}">
                            <svg class="progress-ring" width="80" height="80">
                                <circle class="progress-ring__background" stroke="#b3e5fc" stroke-width="8" fill="transparent" r="30" cx="40" cy="40"/>
                                <circle class="progress-ring__circle" stroke="#66bb6a" stroke-width="8" fill="transparent" r="30" cx="40" cy="40"/>
                            </svg>
                            <div class="progress-number">${student.quizzes}</div>
                        </div>
                        <div class="progress-label">Quizzes</div>
                    </div>
                `;
                progressGrid.appendChild(card);

                // Set Progress Circles
                setCircularProgress(card.querySelector('.progress-circle[data-metric="reading"]'), student.reading, MAX_READING);
                setCircularProgress(card.querySelector('.progress-circle[data-metric="language"]'), student.language, MAX_LANGUAGE);
                setCircularProgress(card.querySelector('.progress-circle[data-metric="quizzes"]'), student.quizzes, MAX_QUIZZES);

                // Add medals if complete
                if (isStudentComplete(student)) {
                    card.querySelector('.student-name').classList.add('completed');
                }

                // Celebrate individual completion
                celebrateStudentCompletion(student);
            });

            updateClassProgressBar();
            checkAllProgress();
        }

        // Helper Function to Get Avatar URL (Placeholder)
        function getAvatarURL(name) {
            // Replace spaces with hyphens and convert to lowercase for URL consistency
            const formattedName = name.toLowerCase().replace(/\s+/g, '-');
            return `https://raw.githubusercontent.com/Daverose123/ixl-app/main/images/${formattedName}.jpg`;
        }

        // Toggle Homework Completion
        function toggleHomework(studentId) {
            const student = students.find(s => s.id === studentId);
            if (student) {
                student.homework = !student.homework;
                saveToLocalStorage();
                renderHomework();
                checkAllHomework();
            }
        }

        // Check if All Homework is Completed
        function checkAllHomework() {
            const allHomeworkDone = students.every(student => student.homework);
            if (allHomeworkDone && !homeworkAlertShown) {
                triggerMassiveConfetti();
                showCelebrationModal("üéâ All homework completed! Great job! üéâ");
                homeworkAlertShown = true;
            }
        }

        // Handle Option Selection from Modal
        function selectOption(option) {
            if (option === 'homework') {
                toggleSection('homework');
            } else if (option === 'progress') {
                toggleSection('progress');
            }
            // Removed 'Use Both' option as per Bug Fix
            // Close the modal
            closeStartupModal();
        }

        // Toggle Sections Based on Navigation
        function toggleSection(section) {
            if (section === 'homework') {
                document.getElementById('homework-section').classList.add('active');
                document.getElementById('progress-section').classList.remove('active');
                document.getElementById('nav-homework').classList.add('active');
                document.getElementById('nav-progress').classList.remove('active');
            } else if (section === 'progress') {
                document.getElementById('progress-section').classList.add('active');
                document.getElementById('homework-section').classList.remove('active');
                document.getElementById('nav-progress').classList.add('active');
                document.getElementById('nav-homework').classList.remove('active');
            }
        }

        // Close Startup Modal
        function closeStartupModal() {
            document.getElementById('startup-modal').style.display = 'none';
        }

        // Handle Keypad Input for Progress Tracker
        function openKeypad(studentId, metric, element) {
            activeStudent = students.find(s => s.id === studentId);
            activeMetric = metric;
            if (!activeStudent) return;

            const keypad = document.getElementById('keypad');
            const overlay = document.getElementById('keypad-overlay');
            overlay.style.display = 'block';
            keypad.style.display = 'block';
            document.getElementById('keypad-display').textContent = ''; // Initialize empty

            // Highlight Selected Circle
            document.querySelectorAll('.progress-circle').forEach(circle => {
                circle.classList.remove('selected');
            });
            element.classList.add('selected');
        }

        function closeKeypad() {
            document.getElementById('keypad').style.display = 'none';
            document.getElementById('keypad-overlay').style.display = 'none';
            activeStudent = null;
            activeMetric = null;
        }

        function addKey(value) {
            const display = document.getElementById('keypad-display');
            display.textContent += value;
        }

        function clearKeypad() {
            document.getElementById('keypad-display').textContent = '';
        }

        function saveKeypad() {
            const display = document.getElementById('keypad-display');
            const value = parseInt(display.textContent, 10);
            if (!isNaN(value)) {
                activeStudent[activeMetric] = Math.min(value, getMaxMetric(activeMetric));
                saveToLocalStorage();
                renderProgress();
                updateClassProgressBar(); // Ensure progress bar updates dynamically
            }
            closeKeypad();
        }

        function getMaxMetric(metric) {
            if (metric === 'reading') return MAX_READING;
            if (metric === 'language') return MAX_LANGUAGE;
            if (metric === 'quizzes') return MAX_QUIZZES;
            return 0;
        }

        // Set Circular Progress
        function setCircularProgress(element, value, max) {
            const circle = element.querySelector('.progress-ring__circle');
            const radius = circle.r.baseVal.value;
            const circumference = 2 * Math.PI * radius;
            const percent = (value / max) * 100;
            const offset = circumference - (percent / 100) * circumference;
            circle.style.strokeDasharray = `${circumference} ${circumference}`;
            circle.style.strokeDashoffset = offset;
        }

        // Check if All Progress is Complete
        function checkAllProgress() {
            const allProgressDone = students.every(student => isStudentComplete(student));
            if (allProgressDone && !progressAlertShown) {
                triggerMassiveConfetti();
                showCelebrationModal("üéâ All students have achieved 100%! Fantastic work! üéâ");
                progressAlertShown = true;
            }
        }

        // Reset Modal Functions
        function openResetModal() {
            document.getElementById('reset-modal-overlay').style.display = 'flex';
            document.getElementById('reset-pin').focus();
        }

        function closeResetModal() {
            document.getElementById('reset-modal-overlay').style.display = 'none';
            document.getElementById('reset-pin').value = '';
        }

        function confirmReset() {
            const enteredPin = document.getElementById('reset-pin').value;
            if (enteredPin === PIN_CODE) {
                // Reset only IXL and Read Theory data
                students.forEach(student => {
                    student.reading = 0;
                    student.language = 0;
                    student.quizzes = 0;
                    // Do not reset homework
                });
                saveToLocalStorage();
                renderProgress();
                updateClassProgressBar();

                // Reset alert flags and confetti triggers as needed
                homeworkAlertShown = false;
                progressAlertShown = false;
                studentConfettiTriggered = {};

                // Close the reset modal
                closeResetModal();

                // Notify user
                showCelebrationModal("üîÑ All IXL data has been reset successfully! üìÖ");
            } else {
                alert("‚ùå Incorrect PIN. Reset denied.");
            }
        }

        // Keyboard Accessibility
        document.addEventListener('keydown', function(event) {
            if (event.key === 'Escape') {
                closeKeypad();
                closeResetModal();
            }
        });

        document.querySelectorAll('.keypad .key').forEach(key => {
            key.addEventListener('keydown', function(event) {
                if (event.key === 'Enter' || event.key === ' ') {
                    event.preventDefault();
                    key.click();
                }
            });
        });

        document.querySelectorAll('.progress-circle').forEach(circle => {
            circle.addEventListener('keydown', function(event) {
                if (event.key === 'Enter' || event.key === ' ') {
                    event.preventDefault();
                    circle.click();
                }
            });
        });

        // Handle Navigation Buttons
        function toggleSection(section) {
            if (section === 'homework') {
                document.getElementById('homework-section').classList.add('active');
                document.getElementById('progress-section').classList.remove('active');
                document.getElementById('nav-homework').classList.add('active');
                document.getElementById('nav-progress').classList.remove('active');
            } else if (section === 'progress') {
                document.getElementById('progress-section').classList.add('active');
                document.getElementById('homework-section').classList.remove('active');
                document.getElementById('nav-progress').classList.add('active');
                document.getElementById('nav-homework').classList.remove('active');
            }
        }

        // Accessibility Enhancements for Navigation Buttons
        document.getElementById('nav-homework').addEventListener('keydown', function(event) {
            if (event.key === 'Enter' || event.key === ' ') {
                event.preventDefault();
                toggleSection('homework');
            }
        });

        document.getElementById('nav-progress').addEventListener('keydown', function(event) {
            if (event.key === 'Enter' || event.key === ' ') {
                event.preventDefault();
                toggleSection('progress');
            }
        });

        document.getElementById('nav-homework').addEventListener('click', function() {
            toggleSection('homework');
        });

        document.getElementById('nav-progress').addEventListener('click', function() {
            toggleSection('progress');
        });

        // Celebration Modal Functions
        function showCelebrationModal(message) {
            const modalOverlay = document.getElementById('celebration-modal-overlay');
            const modal = modalOverlay.querySelector('.celebration-modal');
            modal.querySelector('h3').textContent = message;
            modalOverlay.style.display = 'flex';

            // Trigger confetti
            triggerMassiveConfetti();

            // Automatically hide after 5 seconds
            setTimeout(() => {
                modalOverlay.style.display = 'none';
            }, 5000);
        }
    </script>
</body>
</html>
